<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Typesetting and Converting Mathematics &mdash; MathJax 3.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/font.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hosting Your Own Copy of MathJax" href="hosting.html" />
    <link rel="prev" title="Miscellaneous Components" href="components/misc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MathJax
          </a>
              <div class="version">
                3.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basic/mathjax.html">What is MathJax?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/accessibility.html">MathJax Accessibility Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/mathematics.html">Writing Mathematics for MathJax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/community.html">The MathJax Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/bugs.html">Reporting Issues with MathJax</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Including MathJax in a Web Page</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html"> Getting Started with Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html"> Configuring and Loading MathJax</a></li>
<li class="toctree-l1"><a class="reference internal" href="components/index.html"> The MathJax Components</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Typesetting and Converting Math</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#typesetting-math-in-a-web-page">Typesetting Math in a Web Page</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#handling-asynchronous-typesetting">Handling Asynchronous Typesetting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resetting-automatic-equation-numbering">Resetting Automatic Equation Numbering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-previously-typeset-content">Updating Previously Typeset Content</a></li>
<li class="toctree-l3"><a class="reference internal" href="#looking-up-the-math-on-the-page">Looking up the Math on the Page</a></li>
<li class="toctree-l3"><a class="reference internal" href="#typesetting-user-supplied-content">Typesetting User-Supplied Content</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-mathjax-only-on-pages-with-math">Loading MathJax Only on Pages with Math</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#converting-a-math-string-to-other-formats">Converting a Math String to Other Formats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conversion-options">Conversion Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-the-output-metrics">Obtaining the Output Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-the-output-stylesheet">Obtaining the Output Stylesheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asynchronous-conversion">Asynchronous Conversion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hosting.html"> Hosting Your Own Copy of MathJax</a></li>
<li class="toctree-l1"><a class="reference internal" href="webpack.html"> Making a Custom Build of MathJax</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html"> Examples in a Browser</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MathJax on a Server Using NodeJS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server/start.html">Getting Started with Node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/overview.html">Three Ways to Use MathJax in Node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/examples.html">Examples in Node</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MathJax Input</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../input/tex/index.html">TeX and LaTeX Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/mathml.html">MathML Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/asciimath.html">AsciiMath Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MathJax Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../output/index.html">Output Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output/lazy.html">Lazy Typesetting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output/linebreaks.html">Line Breaking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output/fonts.html">Font Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output/browser.html">Browser Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration Options</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../options/index.html">Configuring MathJax</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced/typeset.html">MathJax in Dynamic Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/extensions.html">Custom Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/model.html">The MathJax Processing Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/synchronize.html">Synchronizing Your Code with MathJax</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The MathJax API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Using the MathJax API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/faq.html">MathJax FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/badges.html">MathJax Badges and Logo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/articles.html">Articles and Presentations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MathJax Updates</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/v2.html">Upgrading from Version 2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">What's New</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MathJax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Typesetting and Converting Mathematics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/web/typeset.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="typesetting-and-converting-mathematics">
<span id="web-typeset"></span><h1>Typesetting and Converting Mathematics<a class="headerlink" href="#typesetting-and-converting-mathematics" title="Permalink to this heading"></a></h1>
<p>There are two main uses for MathJax:</p>
<ul class="simple">
<li><p>Typesetting all the mathematics within a web page, and</p></li>
<li><p>Converting a string containing mathematics into another form.</p></li>
</ul>
<p>In version 2, MathJax could perform the first function very well, but
it was much harder to do the second.  MathJax version 3 makes both
easy to do.  Both these tasks are described below.</p>
<section id="typesetting-math-in-a-web-page">
<span id="typeset-page"></span><h2>Typesetting Math in a Web Page<a class="headerlink" href="#typesetting-math-in-a-web-page" title="Permalink to this heading"></a></h2>
<p>MathJax makes it easy to typeset all the math in a web page, and in
fact it will do this automatically when it is first loaded unless you
configure it not to.  So this is one of the easiest actions to perform
in MathJax; if your page is static, there is nothing to do but load
MathJax.</p>
<p>If your page is dynamic, and you may be adding math after the page is
loaded, then you will need to tell MathJax to typeset the mathematics
once it has been inserted into the page.  There are two methods for
doing that: <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typeset()</span></code> and
<code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetPromise()</span></code>.</p>
<p>The first of these, <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typeset()</span></code>, typesets the page, and
does so immediately and synchronously, so when the call finishes, the
page will have been typeset.  Note, however, that if the math includes
actions that require additional files to be loaded (e.g., TeX input
that uses <cite>require</cite>, or that includes autoloaded extensions), then
an error will be thrown.  You can use the <code class="docutils literal notranslate"><span class="pre">try/catch</span></code> command to
trap this condition.</p>
<p>The second, <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetPromise()</span></code>, performs the typesetting
asynchronously, and returns a promise that is resolved when the
typesetting is complete.  This properly handles loading of external
files, so if you are expecting to process TeX input that can include
<cite>require</cite> or autoloaded extensions, you should use this form of
typesetting.  It can be used with <code class="docutils literal notranslate"><span class="pre">await</span></code> as part of a larger
<code class="docutils literal notranslate"><span class="pre">async</span></code> function.</p>
<p>Both functions take an optional argument, which is an array of elements
whose content should be processed.  An element can be either an actual
DOM element, or a CSS selector string for an element or collection of
elements.  Supplying an array of elements will restrict the
typesetting to the contents of those elements only.</p>
<section id="handling-asynchronous-typesetting">
<span id="typeset-async"></span><h3>Handling Asynchronous Typesetting<a class="headerlink" href="#handling-asynchronous-typesetting" title="Permalink to this heading"></a></h3>
<p>It is generally a bad idea to try to perform multiple asynchronous
typesetting calls simultaneously, so if you are using
<code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetPromise()</span></code> to make several typeset calls, you
should chain them using the promises they return.  For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">typesetPromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// modify the DOM here</span><span class="w"></span>
<span class="w">  </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">typesetPromise</span><span class="p">();</span><span class="w"></span>
<span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>This approach can get complicated fast, however, so you may want to
maintain a promise that can be used to chain the later typesetting
calls.  For example,</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span><span class="w">  </span><span class="c1">// Used to hold chain of typesetting calls</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">typeset</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">typesetPromise</span><span class="p">(</span><span class="nx">code</span><span class="p">()))</span><span class="w"></span>
<span class="w">                   </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Typeset failed: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">promise</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Then you can use <code class="xref js js-meth docutils literal notranslate"><span class="pre">typeset()</span></code> to run code that changes the DOM
and typesets the result.  The <code class="xref js js-meth docutils literal notranslate"><span class="pre">code()</span></code> that you pass it does the
DOM modifications and returns the array of elements to typeset, or
<code class="xref js js-data docutils literal notranslate"><span class="pre">null</span></code> to typeset the whole page.  E.g.,</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">typeset</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#math&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="nx">math</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;$$\\frac{a}{1-a^2}$$&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">math</span><span class="p">];</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>would replace the contents of the element with <code class="docutils literal notranslate"><span class="pre">id=&quot;math&quot;</span></code> with the
specified fraction and have MathJax typeset it (asynchronously).
Because the <code class="xref js js-meth docutils literal notranslate"><span class="pre">then()</span></code> call returns the result of
<code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetPromise()</span></code>, which is itself a promise, the
<code class="xref js js-meth docutils literal notranslate"><span class="pre">then()</span></code> will not resolve until that promise is resolved; i.e.,
not until the typesetting is complete.  Finally, since the
<code class="xref js js-meth docutils literal notranslate"><span class="pre">typeset()</span></code> function returns the <code class="xref js js-data docutils literal notranslate"><span class="pre">promise</span></code>, you can use
<code class="docutils literal notranslate"><span class="pre">await</span></code> in an <code class="docutils literal notranslate"><span class="pre">async</span></code> function to wait for the typesetting to
complete:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">await</span><span class="w"> </span><span class="nx">typeset</span><span class="p">(...);</span><span class="w"></span>
</pre></div>
</div>
<p>Note that this doesn’t take the initial typesetting that MathJax
performs into account, so you might want to use
<code class="xref js js-attr docutils literal notranslate"><span class="pre">MathJax.startup.promise</span></code> in place of <code class="xref js js-data docutils literal notranslate"><span class="pre">promise</span></code> above.
I.e., simply use</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">typeset</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">startup</span><span class="p">.</span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">startup</span><span class="p">.</span><span class="nx">promise</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">typesetPromise</span><span class="p">(</span><span class="nx">code</span><span class="p">()))</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Typeset failed: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">startup</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This avoids the need for the global <code class="xref js js-data docutils literal notranslate"><span class="pre">promise</span></code> variable, and
makes sure that your typesetting doesn’t occur until the initial
typesetting is complete.</p>
</section>
<section id="resetting-automatic-equation-numbering">
<span id="tex-reset"></span><h3>Resetting Automatic Equation Numbering<a class="headerlink" href="#resetting-automatic-equation-numbering" title="Permalink to this heading"></a></h3>
<p>The TeX input jax allows you to automatically number equations. When
modifying a page, this can lead to problems as numbered equations may
be removed and added; most commonly, duplicate labels lead to issues.</p>
<p>You can reset equation numbering using the command</p>
<blockquote>
<div><dl class="describe">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">MathJax.texReset([start])</span></span></dt>
<dd></dd></dl>

</div></blockquote>
<p>where <code class="docutils literal notranslate"><span class="pre">start</span></code> is the number at which to start equation numbering.</p>
</section>
<section id="updating-previously-typeset-content">
<span id="typeset-clear"></span><h3>Updating Previously Typeset Content<a class="headerlink" href="#updating-previously-typeset-content" title="Permalink to this heading"></a></h3>
<p>MathJax keeps track of all the math that it has typeset within your
page.  This is so that if you change the output renderer (using the
MathJax contextual menu), it can be changed to use the new format, for
example; or if you change the accessibility settings, say to enable
the expression explorer, all the math can be updated to include the
speech strings that it uses.  If you modify the page to include new
mathematics and call <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typeset()</span></code> or
<code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetPromise()</span></code>, the newly typeset mathematics will be
added to the list of already typeset mathematics, as you would expect.</p>
<p>If you modify the page to remove content that contains typeset
mathematics, you will need to tell MathJax about that so that it knows
the typeset math that you are removing is no longer on the page.  You
do this by using the <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetClear()</span></code> method.</p>
<p>When called with no arguments, <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetClear()</span></code> tells
MathJax to forget about all the math that has been typeset so far.
Note that the math will remain in the page as typeset math, but
MathJax will no longer know anything about it.  For example, that
means that changes to the output renderer or accessibility settings
will not affect any of the math that was typeset previously.</p>
<p>If you remove math from only a portion of the page, you can call
<code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typesetClear()</span></code> passing it an array of container
elements that have been (or will be) removed, and MathJax will forget
about the math that is within those containers, while remembering the
rest of the math on the page.  For example, if you have an element
with <code class="docutils literal notranslate"><span class="pre">id=&quot;has-math&quot;</span></code> that you have previously typeset, and you are
planning to replace the contents of this element with new content
(stored in a variable <code class="docutils literal notranslate"><span class="pre">new_html</span></code>) that needs to be typeset, you
might use something like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;has-math&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nx">MathJax</span><span class="p">.</span><span class="nx">typesetClear</span><span class="p">([</span><span class="nx">node</span><span class="p">]);</span><span class="w"></span>
<span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">new_html</span><span class="p">;</span><span class="w"></span>
<span class="nx">MathJax</span><span class="p">.</span><span class="nx">typesetPromise</span><span class="p">([</span><span class="nx">node</span><span class="p">]).</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// the new content is has been typeset</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>The argument passed to <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typestClear()</span></code> can be an actual
DOM element, as in the example above, or a CSS selector string (e.g.,
<code class="docutils literal notranslate"><span class="pre">'#has-math'</span></code>), or an array of these.  The selector can specify more
than one container element (e.g., via a class selector).</p>
<p>If you are using automatic equation numbers and insert new content in
the middle of the page, that may require the equation numbers to be
adjusted throughout the page.  In that case, you can do</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">startup</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w"></span>
<span class="nx">MathJax</span><span class="p">.</span><span class="nx">texReset</span><span class="p">();</span><span class="w"></span>
<span class="nx">MathJax</span><span class="p">.</span><span class="nx">typeset</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>to force MathJax to reset the page to the state it was before MathJax
processed it (i.e., remove its typeset math), reset the TeX automatic
line numbering and labels, and then re-typeset the contents of the
page from scratch.</p>
</section>
<section id="looking-up-the-math-on-the-page">
<span id="get-math-items"></span><h3>Looking up the Math on the Page<a class="headerlink" href="#looking-up-the-math-on-the-page" title="Permalink to this heading"></a></h3>
<p>MathJax saves its information about a particular expression that it
has typeset in an object called a <code class="docutils literal notranslate"><span class="pre">MathItem</span></code>; each typeset
expression has an associated MathItem.  You can look up the MathItems
using the <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.startup.document.getMathItemsWithin()</span></code>
function.  You pass this a container element (or a CSS selector for an
element or collection of elements, or an array of containers or
selectors) and it will return an array of the MathItems that are
within those containers.  E.g.,</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">startup</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">getMathItemsWithin</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>will return an array of all the MathItems for the typeset math on the
page.  See the <a class="reference external" href="https://github.com/mathjax/MathJax-src/blob/master/ts/core/MathItem.ts">MathItem definition</a>
for details on the contents of the MathItem structure.  The MathItem
is the v3 replacement for the v2 <cite>ElementJax</cite> object, and
<code class="xref js js-meth docutils literal notranslate"><span class="pre">getMathItemsWithin()</span></code> performs a
similar function to the v2 function <code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.Hub.getAllJax()</span></code>.</p>
</section>
<section id="typesetting-user-supplied-content">
<span id="safe-typesetting"></span><h3>Typesetting User-Supplied Content<a class="headerlink" href="#typesetting-user-supplied-content" title="Permalink to this heading"></a></h3>
<p>Mathematics formats like LaTeX and MathML allow a powerful range of
layout options, including access to hyperlinks, CSS styles, font
selection and sizing, spacing, and so on.  Such features give you a
great deal of flexibility in producing the mathematics for your pages,
but if your readers are allowed to enter mathematics into your pages
(e.g., for a question-and-answer site, or in comments on a blog),
these features can be abused to cause problems for other readers and
pose a potential security risk to them.  For example, the TeX
<code class="docutils literal notranslate"><span class="pre">\href</span></code> command can be used to insert <code class="docutils literal notranslate"><span class="pre">javascript:</span></code> links into the
page, while the <code class="docutils literal notranslate"><span class="pre">\style</span></code> macro could be used to disrupt the user
interface or layout of your pages.</p>
<p>In order to limit the potential interference that could be caused by
the mathematics entered by your readers, MathJax provides the
<cite>ui/safe</cite> extension.  This extension filters the mathematics on the
page in order to try to remove problematic attributes, like javascript
links, or font sizes that are too large or too small, or style
settings that would be disruptive to the page layout.  If your page
allows your readers to post content that includes mathematics
processed by MathJax, you should strongly consider using the
<cite>ui/safe</cite> extension.</p>
<p>See the <a class="reference internal" href="../options/safe.html#safe-options"><span class="std std-ref">Safe Extension Options</span></a> section for details of how to load and
configure the <cite>ui/safe</cite> extension.</p>
</section>
<section id="loading-mathjax-only-on-pages-with-math">
<span id="load-for-math"></span><h3>Loading MathJax Only on Pages with Math<a class="headerlink" href="#loading-mathjax-only-on-pages-with-math" title="Permalink to this heading"></a></h3>
<p>The MathJax combined configuration files are large, and so you may
wish to include MathJax in your page only if it is necessary.  If you
are using a content-management system that puts headers and footers
into your pages automatically, you may not want to include MathJax
directly, unless most of your pages include math, as that would load
MathJax on <em>all</em> your pages.  Once MathJax has been loaded, it should
be in the browser’s cache and load quickly on subsequent pages, but
the first page a reader looks at will load more slowly.  In order to
avoid that, you can use a script like the following one that checks to
see if the content of the page seems to include math, and only loads
MathJax if it does.  Note that this is not a very sophisticated test,
and it may think there is math in some cases when there really isn’t
but it should reduce the number of pages on which MathJax will have to
be loaded.</p>
<p>Create a file called <code class="docutils literal notranslate"><span class="pre">check-for-tex.js</span></code> containing the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/(?:\$|\\\(|\\\[|\\begin\{.*?})/</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">MathJax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">MathJax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">tex</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nx">inlineMath</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;[+]&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[[</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$&#39;</span><span class="p">]]}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">})();</span><span class="w"></span>
</pre></div>
</div>
<p>and then use</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;check-for-tex.js&quot;</span> <span class="na">defer</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>in order to load the script when the page content is ready.  Note
that you will want to include the path to the location where you
stored <code class="docutils literal notranslate"><span class="pre">check-mathjax.js</span></code>, that you should change
<code class="docutils literal notranslate"><span class="pre">tex-chtml.js</span></code> to whatever component file you want to use, and that
the <code class="docutils literal notranslate"><span class="pre">window.MathJax</span></code> value should be set to whatever configuration
you want to use.  In this case, it just adds dollar signs to the
in-line math delimiters.  Finally, adjust the <code class="docutils literal notranslate"><span class="pre">body.match()</span></code> regular
expression to match whatever you are using for math delimiters.</p>
<p>This simply checks if there is something that looks like a TeX in-line
or displayed math delimiter, and loads MathJax if there is.  If you
are using different delimiters, you will need to change the pattern to
include those (and exclude any that you don’t use).  If you are using
AsciiMath instead of TeX, then change the pattern to look for the
AsciiMath delimiters.</p>
<p>If you are using MathML, you may want to use</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;math&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{...}</span><span class="w"></span>
</pre></div>
</div>
<p>for the test instead (provided you aren’t using namespace prefixes,
like <cite>&lt;m:math&gt;</cite>).</p>
<hr class="docutils" />
</section>
</section>
<section id="converting-a-math-string-to-other-formats">
<span id="convert-math"></span><h2>Converting a Math String to Other Formats<a class="headerlink" href="#converting-a-math-string-to-other-formats" title="Permalink to this heading"></a></h2>
<p>An important use case for MathJax is to convert a string containing
mathematics (in one of the three forms that MathJax understands) and
convert it into another form (either MathML, or one of the output
formats that MathJax supports).  This was difficult to do in MathJax
version 2, but easy to do in version 3.</p>
<p>When MathJax starts up, it creates methods for converting from the
input format(s) to the output format(s) that you have loaded, and to
MathML format.  For example, if you have loaded the MathML input jax
and the SVG output jax (say by using the <code class="docutils literal notranslate"><span class="pre">mml-svg</span></code> component), then
MathJax will create the following conversion methods for you:</p>
<blockquote>
<div><dl class="describe">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">MathJax.mathml2svg(math[,options])</span></span></dt>
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">MathJax.mathml2svgPromise(math[,options])</span></span></dt>
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">MathJax.mathml2mml(math[,options])</span></span></dt>
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">MathJax.mathml2mmlPromise(math[,options])</span></span></dt>
<dd></dd></dl>

</div></blockquote>
<p>If you had loaded the TeX input jax as well, you would also get four
more methods, with <code class="docutils literal notranslate"><span class="pre">tex</span></code> in place of <code class="docutils literal notranslate"><span class="pre">mathml</span></code>.</p>
<p>As the names imply, the <code class="docutils literal notranslate"><span class="pre">Promise</span></code> functions perform the conversion
asynchronously, and return promises, while the others operate
synchronously and return the converted form immediately.  The first
two functions (and any others like them) produce DOM elements as the
results of the conversion, with the promise versions passing that to
their <code class="xref js js-meth docutils literal notranslate"><span class="pre">then()</span></code> functions as their argument (see the section on
<a class="reference internal" href="#convert-async"><span class="std std-ref">Asynchronous Conversion</span></a> below), and the non-promise versions returning
them directly.  You can insert these DOM elements into the document
directly, or you can use their <code class="xref js js-attr docutils literal notranslate"><span class="pre">outerHTML</span></code> property to obtain
their serialized string form.</p>
<p>The functions that convert to MathML produce serialized MathML strings
automatically, rather than DOM elements.  (You can use the browser’s
<code class="xref js js-attr docutils literal notranslate"><span class="pre">DOMParser</span></code> object to convert the string into a MathML DOM tree
if you need one.)</p>
<section id="conversion-options">
<span id="id1"></span><h3>Conversion Options<a class="headerlink" href="#conversion-options" title="Permalink to this heading"></a></h3>
<p>All four of these functions require an argument that is the math
string to be converted (e.g., the serialized MathML string, or in the
case of <code class="xref js js-meth docutils literal notranslate"><span class="pre">tex2chtml()</span></code>, the TeX or LaTeX string).  You can also
pass a second argument that is an object containing options that
control the conversion process.  The options that can be included are:</p>
<ul class="simple">
<li><p><code class="xref js js-attr docutils literal notranslate"><span class="pre">display</span></code>, a boolean specifying whether the math is in
display-mode or not (for TeX input).  Default is <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p><code class="xref js js-attr docutils literal notranslate"><span class="pre">em</span></code>, a number giving the number of pixels in an <code class="docutils literal notranslate"><span class="pre">em</span></code> for
the surrounding font.  Default is <code class="docutils literal notranslate"><span class="pre">16</span></code>.</p></li>
<li><p><code class="xref js js-attr docutils literal notranslate"><span class="pre">ex</span></code>, a number giving the number of pixels in an <code class="docutils literal notranslate"><span class="pre">ex</span></code> for
the surrounding font.  Default is <code class="docutils literal notranslate"><span class="pre">8</span></code>.</p></li>
<li><p><code class="xref js js-attr docutils literal notranslate"><span class="pre">containerWidth</span></code>, a number giving the width of the container,
in pixels.  Default is 80 times the <code class="xref js js-attr docutils literal notranslate"><span class="pre">ex</span></code> value.</p></li>
<li><p><code class="xref js js-attr docutils literal notranslate"><span class="pre">lineWidth'</span></code>, a number giving the line-breaking width in
<code class="docutils literal notranslate"><span class="pre">em</span></code> units.  Default is a very large number (100000), so
effectively no line breaking.</p></li>
<li><p><code class="xref js js-attr docutils literal notranslate"><span class="pre">scale</span></code>, a number giving a scaling factor to apply to the
resulting conversion.  Default is 1.</p></li>
</ul>
<p>For example,</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">tex2chtml</span><span class="p">(</span><span class="s1">&#39;\\sqrt{x^2+1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">em</span><span class="o">:</span><span class="w"> </span><span class="mf">12</span><span class="p">,</span><span class="w"> </span><span class="nx">ex</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>would convert the TeX expression <code class="docutils literal notranslate"><span class="pre">\sqrt{x^2+1}</span></code> to HTML as an
in-line expression, with <code class="docutils literal notranslate"><span class="pre">em</span></code> size being 12 pixels and <code class="docutils literal notranslate"><span class="pre">ex</span></code> size
being 6 pixels.  The result will be a DOM element containing the HTML
for the expression.  Similarly,</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">tex2chtml</span><span class="p">(</span><span class="s1">&#39;\\sqrt{x^2+1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">em</span><span class="o">:</span><span class="w"> </span><span class="mf">12</span><span class="p">,</span><span class="w"> </span><span class="nx">ex</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">});</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">html</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>sets <code class="xref js js-data docutils literal notranslate"><span class="pre">text</span></code> to be the serialized HTML string for the expression.</p>
</section>
<section id="obtaining-the-output-metrics">
<span id="get-metrics"></span><h3>Obtaining the Output Metrics<a class="headerlink" href="#obtaining-the-output-metrics" title="Permalink to this heading"></a></h3>
<p>Since the <code class="xref js js-attr docutils literal notranslate"><span class="pre">em</span></code>, <code class="xref js js-attr docutils literal notranslate"><span class="pre">ex</span></code>, and <code class="xref js js-attr docutils literal notranslate"><span class="pre">containerWidth</span></code> all
depend on the location where the math will be placed in the document
(they are values based on the surrounding text font and the container
elements width), MathJax provides a method for obtaining these values
from a given DOM element.  The method</p>
<blockquote>
<div><dl class="describe">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">MathJax.getMetricsFor(node,</span> <span class="pre">display)</span></span></dt>
<dd></dd></dl>

</div></blockquote>
<p>takes a DOM element (<code class="docutils literal notranslate"><span class="pre">node</span></code>) and a boolean (<code class="docutils literal notranslate"><span class="pre">display</span></code>), indicating
if the math is in display mode or not, and returns an object
containing all six of the options listed above.  You can pass this
object directly to the conversion methods discussed above.  So you can
do something like</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#math&#39;</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">getMetricsFor</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">tex2svg</span><span class="p">(</span><span class="s1">&#39;\\sqrt{x^2+1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span><span class="w"></span>
<span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>in order to get the correct metrics for the (eventual) location of
the math that is being converted.  Of course, it would be easier to
simply insert the TeX code into the page and use
<code class="xref js js-meth docutils literal notranslate"><span class="pre">MathJax.typeset()</span></code> to typeset it, but this is just an example
to show you how to obtain the metrics from a particular location in
the page.</p>
<p>Note that obtaining the metrics causes a page refresh, so it is
expensive to do this.  If you need to get the metrics from many
different locations, there are more efficient ways, but these are
advanced topics to be dealt with elsewhere.</p>
</section>
<section id="obtaining-the-output-stylesheet">
<span id="conversion-stylesheet"></span><h3>Obtaining the Output Stylesheet<a class="headerlink" href="#obtaining-the-output-stylesheet" title="Permalink to this heading"></a></h3>
<p>The output from the SVG and CommonHTML output jax both depend on CSS
stylesheets in order to properly format their results.  You can obtain
the SVG stylesheet element by calling</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">svgStylesheet</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>and the HTML stylesheet from</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">chtmlStylesheet</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>The CommonHTML output jax CSS can be quite large, so the output jax
tries to minimize the stylesheet by including only the styles that are
actually needed for the mathematics that has been processed by the
output jax.  That means you should request the stylesheet only <em>after</em>
you have typeset the mathematics itself.</p>
<p>Moreover, if you typeset several expressions, the stylesheet will
include everything needed for all the expressions you have typeset.
If you want to reset the stylesheet, then use</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">startup</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">clearCache</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>if the output jax is the CommonHTML output jax.  So if you want to
produce the style sheet for a single expression, issue the
<code class="xref js js-meth docutils literal notranslate"><span class="pre">clearCache()</span></code> command just before the <code class="xref js js-meth docutils literal notranslate"><span class="pre">tex2chtml()</span></code> call.</p>
</section>
<section id="asynchronous-conversion">
<span id="convert-async"></span><h3>Asynchronous Conversion<a class="headerlink" href="#asynchronous-conversion" title="Permalink to this heading"></a></h3>
<p>If you are converting TeX or LaTeX that might use <cite>require</cite> to load
extensions, or where extensions might be autoloaded, you will either
need to use one of the “full” components that include all the
extensions, or preload all the extensions you need if you plan to use
the synchronous calls listed above.  Otherwise, you can use the
promise-based calls, which handle the loading of extensions
transparently.</p>
<p>For example,</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#math&#39;</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">getMetricsFor</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="nx">MathJax</span><span class="p">.</span><span class="nx">tex2chtmlPromise</span><span class="p">(</span><span class="s1">&#39;\\require{bbox}\\bbox[red]{\\sqrt{x^2+1}}&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">html</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#MJX-CHTML-styles&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span><span class="w"> </span><span class="nx">sheet</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">MathJax</span><span class="p">.</span><span class="nx">chtmlStylesheet</span><span class="p">());</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>would get the metrics for the element with <code class="docutils literal notranslate"><span class="pre">id=&quot;math&quot;</span></code>, convert
the TeX expression using those metrics (properly handling the
asynchronous load needed for the <code class="docutils literal notranslate"><span class="pre">\require</span></code> command); then when the
expression is typeset, it is added to the document and the CHTML
stylesheet is updated.</p>
<p><hr></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="components/misc.html" class="btn btn-neutral float-left" title="Miscellaneous Components" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hosting.html" class="btn btn-neutral float-right" title="Hosting Your Own Copy of MathJax" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 The MathJax Consortium.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>